---
title: 高并发插入大量数据
date: 2023-10-12
description: >
  开发规范：insert语句批量插入的数据行不超过1000.


weight: 60000
---

{{< alert >}}
This is a placeholder page. Replace it with your own content.
{{< /alert >}}


## 一、环境架构



{{< alert title="配置信息">}}

| 硬件名称      | 配置      |
|:--------------|:----------|
| Arch          | aarch64   |
| OS            | Kylin-v10 |
| CPU           | 64C       |
| Memory        | 512G      |
| Space         | 14T       |
| MySQL Version | 8.0.26    |

{{< /alert >}}

## 二、问题现象

N_ISAG_BB集群主库的CPU资源使用瞬间激增，持续时间为2分钟。




## 三、影响范围

该问题暂时对业务无影响。


## 四、问题分析过程

### （1）问题发生时间
问题发生时间段为2023-10-12 14:26:00至2023-10-12 14:28:00，持续2分钟。

### （2）问题处理过程

1. 在收到告警后，登录数据库后台，查看当前数据库状态。经初步确认，没有发现高耗时的SQL。与报障人员确认后，初步判断问题可能源于历史高消耗SQL，导致了 CPU 资源的激增。

2. 接着查看慢查询日志，分析发现这个时间段产生了慢SQL语句且平均执行时间在20s左右，而在平常该类型语句平均耗时3s以内，因此该时间段内的慢查询是因资源无法满足所致，如下图所示

3. 随后，通过分析该时间段内的binlog日志，发现存在高并发批次插入大量数据行的SQL语句，一次insert数据量最高达到86万条，如下图

4. 根据上述输出信息，我们可以得出以下结论：高并发批次插入大量数据，导致数据库性能下降，进而出现大量慢查询。

## 五、问题原因分析
{{< alert title="原因">}}

N_ISAG_BB系统CPU使用激增问题由高并发批次插入大量数据，导致数据库性能下降出现大量慢查询，并发线程堆积使得CPU使用率激增，innodb层的并发线程处理被慢查询阻塞。

{{< /alert >}}

## 六、解决问题
{{< alert title="建议">}}

针对高并发批次插入大量数据导致优化选择错误的执行计划的问题，给出如下建议：

- 请应用侧遵循开发规范，insert语句批量插入的数据行不超过1000。

{{< /alert >}}



































