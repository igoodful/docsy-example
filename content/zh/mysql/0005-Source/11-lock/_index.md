---
title: lock
description: lock
date: 2023-10-30
weight: 11000


---

<style>
th, td {
  border: 1px solid rgb(190, 190, 190);
}
</style>



| 配置                  | 参数          | 备注         |
| :-------------------- | :------------ | :----------- |
| version               | 8.0.32        | 版本         |
| engine                | innodb        | 存储引擎     |
| transaction_isolation | read commited | 事务隔离级别 |


{{<alert color="secondary">}}


{{</alert>}}


## 一、innodb 行级别锁


#### 1. 共享锁与排他锁

| 兼容性 | S        | X        |
| :----- | :------- | :------- |
| S      | &#9989;  | &#10060; |
| X      | &#10060; | &#10060; |

- &#9989; 表示兼容
- &#10060; 表示不兼容

---

#### 2. 锁模式兼容表

| 锁模式     | 意向共享锁 | 意向排他锁 | 共享锁   | 排他锁   | AUTO-INC锁 |
| :--------- | :--------- | :--------- | :------- | :------- | :--------- |
| 意向共享锁 | &#9989;    | &#9989;    | &#9989;  | &#10060; | &#9989;    |
| 意向排他锁 | &#9989;    | &#9989;    | &#10060; | &#10060; | &#9989;    |
| 共享锁     | &#9989;    | &#10060;   | &#9989;  | &#10060; | &#10060;   |
| 排他锁     | &#10060;   | &#10060;   | &#10060; | &#10060; | &#10060;   |
| AUTO-INC锁 | &#9989;    | &#9989;    | &#10060; | &#10060; | &#10060;   |

- &#9989; 表示锁兼容
- &#10060; 表示锁不兼容



#### 3. S锁和X锁

###### S锁
```sql
select ... lock in share mode;

```

###### X锁
```sql
select ... for update;

delete from

insert into

update


```


## 二、innodb 表级别锁


#### 1. 表锁

```sql
[root@127.0.0.1:8032 12:53:47(db1)]$ show global variables like '%innodb_table_locks';
+--------------------+-------+
| Variable_name      | Value |
+--------------------+-------+
| innodb_table_locks | ON    |
+--------------------+-------+
1 row in set (0.01 sec)

[root@127.0.0.1:8032 16:35:38(db1)]$

```


```sql
lock tables t read;

lock tables t write;

```
- innodb 存储引擎会对表 t 加表级别的 s锁 。
- innodb 存储引擎会对表 t 加表级别的 x锁 。




#### 2. 表级别的IS锁、IX锁




#### 3. 表级别的AUTO-INC锁

