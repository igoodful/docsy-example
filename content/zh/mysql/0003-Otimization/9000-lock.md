---
title: 9. lock
description: lock
date: 2023-10-13
weight: 9000


---
<style>
th, td {
  border: 1px solid rgb(190, 190, 190);
}
</style>

{{<alert  color="secondary">}}



{{</alert>}}

| 配置                  | 参数          | 备注         |
| :-------------------- | :------------ | :----------- |
| version               | 8.0.32        | 版本         |
| engine                | innodb        | 存储引擎     |
| transaction_isolation | read commited | 事务隔离级别 |



### innodb的dml操作的行级锁的等待时间
```sql
mysql> show global variables like 'innodb_lock_wait_timeout';
+--------------------------+-------+
| Variable_name            | Value |
+--------------------------+-------+
| innodb_lock_wait_timeout | 50    |
+--------------------------+-------+
1 row in set (0.00 sec)



```


```sql
mysql> show create table sbtest6\G
*************************** 1. row ***************************
       Table: sbtest6
Create Table: CREATE TABLE `sbtest6` (
  `id` int NOT NULL AUTO_INCREMENT,
  `k` int NOT NULL DEFAULT '0',
  `c` char(120) NOT NULL DEFAULT '',
  `pad` char(60) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4999989 DEFAULT CHARSET=utf8mb3
1 row in set (0.00 sec)

mysql> select * from sbtest6 limit 10;
+----+----------+-------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| id | k        | c                                                                                                                       | pad                                                         |
+----+----------+-------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+
|  1 |  5109087 | 59327024190-81982521231-49874289470-85855318058-17232956115-81311006177-45953644467-89499997690-67582327146-61677430513 | 38595829074-70377467703-10468302874-28187723626-90239842892 |
|  2 | 19521257 | 17683594789-79094539502-64837025634-64401068468-93240347875-80207879399-06064830238-97247190956-35331442429-27373799568 | 39867820778-36349548421-07211377689-04092563728-84547810663 |
|  3 |  5748395 | 61797781472-21953685237-07018708078-59981880857-37650143801-66343838907-16569591625-91667390697-45471315514-20364506742 | 13476534366-22984408533-40354781449-60565035016-89557734953 |
|  4 | 15313280 | 88920467586-66410083524-11781648854-34930760528-70662863649-23485665819-94723913968-83036943042-73943487319-04850499178 | 19906396648-97010315835-49736238240-72269471454-34130982626 |
|  5 |  7013358 | 30771176939-88385383773-44751417382-14055119740-96335151493-93177611868-60086147018-13260354378-58599295103-28980000699 | 12256620636-74343475627-02875391133-37157228774-01159952757 |
|  6 | 18684763 | 80989859653-98457728319-08145775523-34380764845-46043181388-86146987729-98331886407-11504907765-31842528781-56170904522 | 36315543543-14317651291-74849276799-61220719236-08218205970 |
|  7 |  3094048 | 00997564811-56471206857-16200241075-09682504260-72148213636-42877331215-65010152605-60186210864-47916223711-99920462873 | 76121109438-47702494281-61430845633-45170497644-71831017750 |
|  8 |  9793751 | 89737996734-58648010579-71002365283-46684459953-64473149994-40277176852-27005029835-05901804451-40066793451-25994121128 | 81287426156-83520346657-05021808288-60007242249-89675256229 |
|  9 | 12341383 | 85124405172-10559209448-49927629209-69312907139-91376859631-86634255302-25545875312-81509113405-58831717318-27119761102 | 46050653664-97157950366-39785375699-30334396168-90286743965 |
| 10 | 15483139 | 49563180585-20881622859-05274198712-89669957478-53476509202-97356889842-11361452028-55614541466-94253908053-03879509450 | 38901954498-31448177235-23983427156-21396244086-57132083921 |
+----+----------+-------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+
10 rows in set (0.00 sec)

```

1. 会锁住：ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction
| T1                                   | T2                                    |
| :----------------------------------- | :------------------------------------ |
| begin;                               |                                       |
| delete  FROM sbtest6  WHERE id = 15; |                                       |
|                                      | begin;                                |
|                                      | delete  FROM sbtest6  WHERE id <= 14; |



2. 会锁住：ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction
| T1                                   | T2                                   |
| :----------------------------------- | :----------------------------------- |
| begin;                               |                                      |
| delete  FROM sbtest6  WHERE id = 15; |                                      |
|                                      | begin;                               |
|                                      | delete  FROM sbtest6  WHERE id < 15; |





